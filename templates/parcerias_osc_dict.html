<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dicion√°rio de OSCs</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
<style>
body { background-color: #f5f5f5; }
.main-container { background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 2rem; margin: 2rem auto; max-width: 1400px; }
.header-section { border-bottom: 2px solid #0d6efd; padding-bottom: 1rem; margin-bottom: 2rem; }
.info-box { background-color: #e7f3ff; border-left: 4px solid #0d6efd; padding: 1rem; margin-bottom: 1.5rem; border-radius: 4px; }
.stats-card { text-align: center; padding: 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; margin-bottom: 1rem; }
.stats-card h2 { font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem; }
.stats-card.success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
.stats-card.info { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }
.osc-input { border: 2px solid #e0e0e0; padding: 0.5rem; border-radius: 4px; width: 100%; transition: all 0.2s; }
.osc-input:focus { border-color: #667eea; outline: none; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
.osc-input.modified { border-color: #ffc107; background-color: #fff9e6; }
.btn-salvar { opacity: 0; transition: all 0.2s; }
tr:hover .btn-salvar { opacity: 1; }
.table thead { background-color: #2c3e50; color: white; }
.table tbody tr:hover { background-color: #f8f9fa; }
.checkbox-alteracao { width: 20px; height: 20px; cursor: pointer; }
tr.marcado-alteracao { background-color: #fff9e6; border-left: 4px solid #ffc107; }
.action-bar { position: sticky; bottom: 0; background: linear-gradient(to right, #667eea, #764ba2); padding: 1rem; border-radius: 8px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: none; z-index: 1000; }
.action-bar.show { display: flex; }
.contador-selecao { background: rgba(255,255,255,0.2); padding: 0.5rem 1rem; border-radius: 4px; color: white; font-weight: bold; }
.badge.bg-success:hover { background-color: #157347 !important; transform: scale(1.05); transition: all 0.2s; cursor: pointer; }
.modal-body .table { margin-bottom: 0; }
.table-success { background-color: #d1e7dd !important; }
</style>
</head>
<body>
<div class="main-container">
<div class="header-section">
<div class="d-flex justify-content-between align-items-center">
<h1><i class="bi bi-building text-primary"></i> Dicion√°rio de OSCs</h1>
<a href="{{ url_for('parcerias.listar') }}" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Voltar</a>
</div>
</div>
<div class="info-box">
<h5><i class="bi bi-info-circle"></i> Como usar:</h5>
<ul class="mb-0">
<li><strong>Padronizar:</strong> Edite o nome da OSC para corrigir erros ou padronizar grafias</li>
<li><strong>Atualiza√ß√£o em massa:</strong> Ao salvar, TODOS os termos associados ser√£o atualizados</li>
<li><strong>Ver termos:</strong> Clique no badge verde para ver todos os termos da OSC</li>
</ul>
</div>
<div class="row mb-4">
<div class="col-md-4"><div class="stats-card"><h2>{{ total_oscs }}</h2><p>OSCs √önicas</p></div></div>
<div class="col-md-4"><div class="stats-card success"><h2>{{ oscs|sum(attribute='total_termos') }}</h2><p>Total de Termos (p√°gina atual)</p></div></div>
<div class="col-md-4"><div class="stats-card info"><h2 id="contadorModificacoes">0</h2><p>Modifica√ß√µes Pendentes</p></div></div>
</div>

<!-- Informa√ß√µes de Pagina√ß√£o -->
<div class="alert alert-info mb-3" id="alertInfo">
    <i class="bi bi-info-circle"></i> Mostrando <strong>{{ ((pagina_atual - 1) * 50) + 1 }}</strong> a <strong>{{ [pagina_atual * 50, total_oscs]|min }}</strong> de <strong>{{ total_oscs }}</strong> OSCs | P√°gina <strong>{{ pagina_atual }}</strong> de <strong>{{ total_paginas }}</strong>
</div>

<div class="mb-3">
<input type="text" class="form-control form-control-lg" id="filtroOSC" placeholder="üîç Buscar OSC...">
</div>

<!-- Controles de Pagina√ß√£o -->
<nav aria-label="Pagina√ß√£o de OSCs" class="mb-3" id="paginacaoTop">
    <ul class="pagination justify-content-center">
        <!-- Bot√£o Anterior -->
        <li class="page-item {% if pagina_atual == 1 %}disabled{% endif %}">
            <a class="page-link" href="{% if pagina_atual > 1 %}{{ url_for('parcerias.dicionario_oscs', pagina=pagina_atual - 1) }}{% else %}#{% endif %}" aria-label="Anterior">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        
        <!-- Primeira p√°gina -->
        {% if pagina_atual > 3 %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('parcerias.dicionario_oscs', pagina=1) }}">1</a>
        </li>
        {% if pagina_atual > 4 %}
        <li class="page-item disabled">
            <a class="page-link" href="#">...</a>
        </li>
        {% endif %}
        {% endif %}
        
        <!-- P√°ginas numeradas -->
        {% for p in range([1, pagina_atual - 2]|max, [total_paginas, pagina_atual + 2]|min + 1) %}
        <li class="page-item {% if p == pagina_atual %}active{% endif %}">
            <a class="page-link" href="{{ url_for('parcerias.dicionario_oscs', pagina=p) }}">{{ p }}</a>
        </li>
        {% endfor %}
        
        <!-- √öltima p√°gina -->
        {% if pagina_atual < total_paginas - 2 %}
        {% if pagina_atual < total_paginas - 3 %}
        <li class="page-item disabled">
            <a class="page-link" href="#">...</a>
        </li>
        {% endif %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('parcerias.dicionario_oscs', pagina=total_paginas) }}">{{ total_paginas }}</a>
        </li>
        {% endif %}
        
        <!-- Bot√£o Pr√≥ximo -->
        <li class="page-item {% if pagina_atual == total_paginas %}disabled{% endif %}">
            <a class="page-link" href="{% if pagina_atual < total_paginas %}{{ url_for('parcerias.dicionario_oscs', pagina=pagina_atual + 1) }}{% else %}#{% endif %}" aria-label="Pr√≥xima">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>
</nav>
<div class="table-responsive">
<table class="table table-hover">
<thead><tr>
<th style="width:3%" class="text-center">
    <input type="checkbox" id="selecionarTodos" class="checkbox-alteracao" title="Selecionar todas as altera√ß√µes">
</th>
<th style="width:40%">Nome da OSC</th>
<th style="width:18%">CNPJ (Exemplo)</th>
<th style="width:9%" class="text-center">Termos</th>
<th style="width:30%" class="text-center">A√ß√µes</th>
</tr></thead>
<tbody id="tbody">
{% for osc_item in oscs %}
<tr data-original-osc="{{ osc_item.osc }}">
<td class="text-center">
    <input type="checkbox" class="checkbox-alteracao checkbox-linha" disabled>
</td>
<td><input type="text" class="osc-input" value="{{ osc_item.osc }}" data-original="{{ osc_item.osc }}"></td>
<td><span class="badge bg-secondary">{{ osc_item.cnpj_exemplo or 'N/A' }}</span></td>
<td class="text-center">
    {% if osc_item.total_termos > 0 %}
        <span class="badge bg-success badge-termos" 
            data-osc="{{ osc_item.osc }}"
            data-total-termos="{{ osc_item.total_termos }}"
            title="Clique para ver os termos">
            <i class="bi bi-list-ul"></i> {{ osc_item.total_termos }}
        </span>
    {% elif osc_item.total_cents > 0 %}
        <span class="badge bg-info" title="OSC exclusiva de CENTS">
            <i class="bi bi-award"></i> CENTS
        </span>
    {% else %}
        <span class="badge bg-secondary">0</span>
    {% endif %}
</td>
<td class="text-center">
    <button class="btn btn-primary btn-sm btn-salvar me-1" onclick="salvarOSC(this)" title="Salvar altera√ß√µes">
        <i class="bi bi-check-lg"></i> Salvar
    </button>
    <button class="btn btn-info btn-sm" onclick="gerenciarContatos('{{ osc_item.osc }}')" title="Gerenciar contatos">
        <i class="bi bi-person-lines-fill"></i> Contatos
    </button>
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

<!-- Barra de A√ß√£o para Salvar M√∫ltiplos -->
<div class="action-bar" id="actionBar">
    <div class="d-flex justify-content-between align-items-center w-100">
        <div class="contador-selecao">
            <i class="bi bi-check-square"></i> <span id="contadorSelecionados">0</span> altera√ß√£o(√µes) selecionada(s)
        </div>
        <div>
            <button class="btn btn-light me-2" onclick="desmarcarTodos()">
                <i class="bi bi-x-circle"></i> Desmarcar Todos
            </button>
            <button class="btn btn-success btn-lg" onclick="salvarSelecionados()">
                <i class="bi bi-check-circle"></i> Salvar Selecionados
            </button>
        </div>
    </div>
</div>

<!-- Modal de Termos -->
<div class="modal fade" id="modalTermos" tabindex="-1" aria-labelledby="modalTermosLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="modalTermosLabel">
                    <i class="bi bi-list-ul"></i> Termos da OSC
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info mb-3">
                    <strong>OSC:</strong> <span id="oscNome"></span><br>
                    <strong>Total de Termos:</strong> <span id="totalTermos"></span>
                </div>
                <div id="listaTermos">
                    <div class="text-center">
                        <div class="spinner-border text-success" role="status">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Contatos -->
<div class="modal fade" id="modalContatos" tabindex="-1" aria-labelledby="modalContatosLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="modalContatosLabel">
                    <i class="bi bi-person-lines-fill"></i> Gerenciar Contatos da OSC
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info mb-3">
                    <strong>OSC:</strong> <span id="oscNomeContatos"></span>
                </div>
                
                <!-- Formul√°rio de Novo Contato -->
                <div class="card mb-3">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0"><i class="bi bi-plus-circle"></i> Adicionar Novo Contato</h6>
                    </div>
                    <div class="card-body">
                        <form id="formNovoContato">
                            <!-- Campos √önicos -->
                            <div class="row g-3 mb-3">
                                <div class="col-md-6">
                                    <label for="novo_contato_nome" class="form-label">
                                        Nome *
                                        <i class="bi bi-info-circle text-primary" 
                                           data-bs-toggle="tooltip" 
                                           data-bs-placement="right" 
                                           title="Para contatos institucionais, pode usar apenas 'Institucional'"
                                           style="cursor: help;"></i>
                                    </label>
                                    <input type="text" class="form-control" id="novo_contato_nome" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="novo_contato_posicao" class="form-label">Posi√ß√£o</label>
                                    <input type="text" class="form-control" id="novo_contato_posicao" placeholder="Ex: Diretor, Coordenador">
                                </div>
                            </div>
                            
                            <!-- Blocos de Contato Din√¢micos -->
                            <div class="border rounded p-3 mb-3 bg-light">
                                <h6 class="mb-3">Tipos de Contato</h6>
                                <div id="contatosContainer"></div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="adicionarBlocoContato()">
                                    <i class="bi bi-plus-circle"></i> Adicionar Tipo de Contato
                                </button>
                            </div>
                            
                            <!-- Observa√ß√£o -->
                            <div class="mb-3">
                                <label for="novo_observacao" class="form-label">Observa√ß√£o</label>
                                <textarea class="form-control" id="novo_observacao" rows="3" placeholder="Informa√ß√µes adicionais (opcional)"></textarea>
                            </div>
                            
                            <div class="text-end">
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-check-circle"></i> Salvar Contato(s)
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Lista de Contatos Existentes -->
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        <h6 class="mb-0"><i class="bi bi-list-ul"></i> Contatos Cadastrados</h6>
                    </div>
                    <div class="card-body">
                        <div id="listaContatos">
                            <div class="text-center">
                                <div class="spinner-border text-info" role="status">
                                    <span class="visually-hidden">Carregando...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Editar Contato -->
<div class="modal fade" id="modalEditarContato" tabindex="-1" aria-labelledby="modalEditarContatoLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title" id="modalEditarContatoLabel">
                    <i class="bi bi-pencil"></i> Editar Contato
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="formEditarContato">
                    <input type="hidden" id="edit_contato_id">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="edit_contato_nome" class="form-label">Nome *</label>
                            <input type="text" class="form-control" id="edit_contato_nome" required>
                        </div>
                        <div class="col-md-6">
                            <label for="edit_contato_posicao" class="form-label">Posi√ß√£o</label>
                            <input type="text" class="form-control" id="edit_contato_posicao">
                        </div>
                        <div class="col-md-6">
                            <label for="edit_contato_tipo" class="form-label">Tipo de Contato *</label>
                            <select class="form-select" id="edit_contato_tipo" required onchange="ajustarMascara('edit')">
                                <option value="">-- Selecione --</option>
                                <option value="E-mail Institucional">E-mail Institucional</option>
                                <option value="E-mail Pessoal">E-mail Pessoal</option>
                                <option value="Telefone Institucional">Telefone Institucional</option>
                                <option value="Telefone Pessoal">Telefone Pessoal</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="edit_contato_info" class="form-label">Informa√ß√£o de Contato *</label>
                            <input type="text" class="form-control" id="edit_contato_info" required>
                            <small class="text-muted" id="hint_edit"></small>
                        </div>
                        <div class="col-md-6">
                            <label for="edit_status" class="form-label">Status *</label>
                            <select class="form-select" id="edit_status" required>
                                <option value="Ativo">Ativo</option>
                                <option value="Inativo">Inativo</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="edit_observacao" class="form-label">Observa√ß√£o</label>
                            <input type="text" class="form-control" id="edit_observacao">
                        </div>
                    </div>
                    <div class="mt-3 text-end">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-warning">
                            <i class="bi bi-check-lg"></i> Salvar Altera√ß√µes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Controles de Pagina√ß√£o Inferior -->
<nav aria-label="Pagina√ß√£o de OSCs" class="mt-4" id="paginacaoBottom">
    <ul class="pagination justify-content-center">
        <!-- Bot√£o Anterior -->
        <li class="page-item {% if pagina_atual == 1 %}disabled{% endif %}">
            <a class="page-link" href="{% if pagina_atual > 1 %}{{ url_for('parcerias.dicionario_oscs', pagina=pagina_atual - 1) }}{% else %}#{% endif %}" aria-label="Anterior">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        
        <!-- Primeira p√°gina -->
        {% if pagina_atual > 3 %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('parcerias.dicionario_oscs', pagina=1) }}">1</a>
        </li>
        {% if pagina_atual > 4 %}
        <li class="page-item disabled">
            <a class="page-link" href="#">...</a>
        </li>
        {% endif %}
        {% endif %}
        
        <!-- P√°ginas numeradas -->
        {% for p in range([1, pagina_atual - 2]|max, [total_paginas, pagina_atual + 2]|min + 1) %}
        <li class="page-item {% if p == pagina_atual %}active{% endif %}">
            <a class="page-link" href="{{ url_for('parcerias.dicionario_oscs', pagina=p) }}">{{ p }}</a>
        </li>
        {% endfor %}
        
        <!-- √öltima p√°gina -->
        {% if pagina_atual < total_paginas - 2 %}
        {% if pagina_atual < total_paginas - 3 %}
        <li class="page-item disabled">
            <a class="page-link" href="#">...</a>
        </li>
        {% endif %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('parcerias.dicionario_oscs', pagina=total_paginas) }}">{{ total_paginas }}</a>
        </li>
        {% endif %}
        
        <!-- Bot√£o Pr√≥ximo -->
        <li class="page-item {% if pagina_atual == total_paginas %}disabled{% endif %}">
            <a class="page-link" href="{% if pagina_atual < total_paginas %}{{ url_for('parcerias.dicionario_oscs', pagina=pagina_atual + 1) }}{% else %}#{% endif %}" aria-label="Pr√≥xima">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>
</nav>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Vari√°vel para armazenar timeout de busca
let timeoutBusca = null;

// Fun√ß√£o para ver termos de uma OSC
function verTermos(osc, totalTermos) {
    // Atualizar informa√ß√µes do modal
    document.getElementById('oscNome').textContent = osc;
    document.getElementById('totalTermos').textContent = totalTermos;
    
    // Mostrar modal
    const modal = new bootstrap.Modal(document.getElementById('modalTermos'));
    modal.show();
    
    // Resetar conte√∫do
    const listaTermos = document.getElementById('listaTermos');
    listaTermos.innerHTML = '<div class="text-center"><div class="spinner-border text-success" role="status"><span class="visually-hidden">Carregando...</span></div></div>';
    
    // Buscar termos do backend
    fetch('/parcerias/termos-por-osc/' + encodeURIComponent(osc))
        .then(r => r.json())
        .then(data => {
            if (data.error) {
                listaTermos.innerHTML = '<div class="alert alert-danger">‚ùå Erro: ' + data.error + '</div>';
                return;
            }
            
            if (data.termos.length === 0) {
                listaTermos.innerHTML = '<div class="alert alert-warning">Nenhum termo encontrado.</div>';
                return;
            }
            
            // Criar tabela com os termos
            let html = '<table class="table table-hover table-striped">';
            html += '<thead class="table-success"><tr>';
            html += '<th style="width: 25%"><i class="bi bi-file-text"></i> N√∫mero do Termo</th>';
            html += '<th style="width: 15%"><i class="bi bi-tag"></i> Tipo</th>';
            html += '<th style="width: 25%"><i class="bi bi-folder"></i> Projeto</th>';
            html += '<th style="width: 10%" class="text-center"><i class="bi bi-calendar"></i> In√≠cio</th>';
            html += '<th style="width: 10%" class="text-center"><i class="bi bi-calendar-check"></i> T√©rmino</th>';
            html += '<th style="width: 15%" class="text-end"><i class="bi bi-currency-dollar"></i> Valor Previsto</th>';
            html += '</tr></thead><tbody>';
            
            let valorGrandTotal = 0;
            
            data.termos.forEach(termo => {
                valorGrandTotal += termo.total_previsto;
                
                html += '<tr>';
                html += '<td><strong>' + termo.numero_termo + '</strong></td>';
                html += '<td><span class="badge bg-info">' + (termo.tipo_termo || '-') + '</span></td>';
                html += '<td>' + (termo.projeto || '-') + '</td>';
                html += '<td class="text-center">' + termo.inicio + '</td>';
                html += '<td class="text-center">' + termo.final + '</td>';
                html += '<td class="text-end">R$ ' + termo.total_previsto.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + '</td>';
                html += '</tr>';
            });
            
            html += '</tbody>';
            html += '<tfoot class="table-secondary"><tr>';
            html += '<th colspan="5">TOTAL PREVISTO</th>';
            html += '<th class="text-end"><strong>R$ ' + valorGrandTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + '</strong></th>';
            html += '</tr></tfoot>';
            html += '</table>';
            
            listaTermos.innerHTML = html;
        })
        .catch(error => {
            listaTermos.innerHTML = '<div class="alert alert-danger">‚ùå Erro ao carregar termos: ' + error + '</div>';
        });
}

// Gerenciamento de checkboxes e sele√ß√£o m√∫ltipla
function atualizarContadorSelecao() {
    const checkboxesMarcadas = document.querySelectorAll('.checkbox-linha:checked');
    const total = checkboxesMarcadas.length;
    document.getElementById('contadorSelecionados').textContent = total;
    document.getElementById('contadorModificacoes').textContent = total;
    
    const actionBar = document.getElementById('actionBar');
    if (total > 0) {
        actionBar.classList.add('show');
    } else {
        actionBar.classList.remove('show');
    }
}

// Selecionar/Desmarcar todos
document.getElementById('selecionarTodos').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.checkbox-linha:not(:disabled)');
    checkboxes.forEach(cb => {
        cb.checked = this.checked;
        const linha = cb.closest('tr');
        if (this.checked) {
            linha.classList.add('marcado-alteracao');
        } else {
            linha.classList.remove('marcado-alteracao');
        }
    });
    atualizarContadorSelecao();
});

function desmarcarTodos() {
    document.querySelectorAll('.checkbox-linha:checked').forEach(cb => {
        cb.checked = false;
        cb.closest('tr').classList.remove('marcado-alteracao');
    });
    document.getElementById('selecionarTodos').checked = false;
    atualizarContadorSelecao();
}

// Busca global no banco de dados
document.getElementById('filtroOSC').addEventListener('input', function(e) {
    const termoBusca = e.target.value.trim();
    
    // Limpar timeout anterior
    if (timeoutBusca) {
        clearTimeout(timeoutBusca);
    }
    
    // Se vazio, recarregar p√°gina normal
    if (termoBusca === '') {
        window.location.href = '{{ url_for("parcerias.dicionario_oscs") }}';
        return;
    }
    
    // Aguardar 500ms antes de fazer a busca (debounce)
    timeoutBusca = setTimeout(() => {
        realizarBuscaGlobal(termoBusca);
    }, 500);
});

function realizarBuscaGlobal(termo) {
    // Mostrar indicador de carregamento
    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '<tr><td colspan="5" class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Buscando...</span></div></td></tr>';
    
    fetch('/parcerias/buscar-oscs?q=' + encodeURIComponent(termo))
        .then(r => r.json())
        .then(data => {
            if (data.error) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-danger">‚ùå Erro: ' + data.error + '</td></tr>';
                return;
            }
            
            if (data.oscs.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">üîç Nenhuma OSC encontrada com "' + termo + '"</td></tr>';
                return;
            }
            
            // Atualizar estat√≠sticas
            document.querySelector('.stats-card h2').textContent = data.total;
            
            // Ocultar pagina√ß√£o durante busca
            document.getElementById('paginacaoTop').style.display = 'none';
            document.getElementById('paginacaoBottom').style.display = 'none';
            
            // Atualizar alerta de info
            const alertInfo = document.getElementById('alertInfo');
            alertInfo.innerHTML = '<i class="bi bi-search"></i> Mostrando <strong>' + data.total + '</strong> resultado(s) para "<strong>' + data.termo_busca + '</strong>" | <a href="{{ url_for("parcerias.dicionario_oscs") }}" class="alert-link">Limpar busca</a>';
            
            // Renderizar resultados
            let html = '';
            data.oscs.forEach(osc => {
                html += `
                <tr data-original-osc="${osc.osc}">
                    <td class="text-center"><input type="checkbox" class="checkbox-alteracao checkbox-linha" disabled></td>
                    <td><input type="text" class="osc-input" value="${osc.osc}" data-original="${osc.osc}"></td>
                    <td><span class="badge bg-secondary">${osc.cnpj_exemplo || 'N/A'}</span></td>
                    <td class="text-center">
                        <span class="badge bg-success badge-termos" data-osc="${osc.osc}" data-total-termos="${osc.total_termos}" title="Clique para ver os termos">
                            <i class="bi bi-list-ul"></i> ${osc.total_termos}
                        </span>
                    </td>
                    <td class="text-center">
                        <button class="btn btn-primary btn-sm btn-salvar me-1" onclick="salvarOSC(this)" title="Salvar altera√ß√µes"><i class="bi bi-check-lg"></i> Salvar</button>
                        <button class="btn btn-info btn-sm" onclick="gerenciarContatos('${osc.osc}')" title="Gerenciar contatos"><i class="bi bi-person-lines-fill"></i> Contatos</button>
                    </td>
                </tr>
                `;
            });
            tbody.innerHTML = html;
            
            // Reconfigurar eventos nos inputs e badges
            configurarEventosInputs();
            configurarEventosBadges();
        })
        .catch(error => {
            tbody.innerHTML = '<tr><td colspan="5" class="text-center text-danger">‚ùå Erro na busca: ' + error + '</td></tr>';
        });
}

function configurarEventosInputs() {
    document.querySelectorAll('.osc-input').forEach(input => {
        input.addEventListener('input', function() {
            const modificado = this.value.trim() !== this.dataset.original;
            this.classList.toggle('modified', modificado);
            
            const linha = this.closest('tr');
            const checkbox = linha.querySelector('.checkbox-linha');
            
            // Habilitar/desabilitar checkbox baseado na modifica√ß√£o
            if (modificado) {
                checkbox.disabled = false;
                checkbox.checked = true;
                linha.classList.add('marcado-alteracao');
            } else {
                checkbox.disabled = true;
                checkbox.checked = false;
                linha.classList.remove('marcado-alteracao');
            }
            
            atualizarContadorSelecao();
        });
        
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') salvarOSC(this.closest('tr').querySelector('.btn-salvar'));
        });
    });
    
    // Eventos das checkboxes
    document.querySelectorAll('.checkbox-linha').forEach(cb => {
        cb.addEventListener('change', function() {
            const linha = this.closest('tr');
            if (this.checked) {
                linha.classList.add('marcado-alteracao');
            } else {
                linha.classList.remove('marcado-alteracao');
            }
            atualizarContadorSelecao();
        });
    });
}

// Configurar eventos iniciais
configurarEventosInputs();

// Salvar OSCs selecionadas em lote
function salvarSelecionados() {
    const linhasSelecionadas = document.querySelectorAll('.checkbox-linha:checked');
    
    if (linhasSelecionadas.length === 0) {
        alert('‚ö† Nenhuma altera√ß√£o selecionada!');
        return;
    }
    
    // Coletar todas as altera√ß√µes
    const alteracoes = [];
    linhasSelecionadas.forEach(cb => {
        const linha = cb.closest('tr');
        const input = linha.querySelector('.osc-input');
        const oscAntiga = input.dataset.original;
        const oscNova = input.value.trim();
        
        if (oscNova && oscAntiga !== oscNova) {
            alteracoes.push({
                antiga: oscAntiga,
                nova: oscNova
            });
        }
    });
    
    if (alteracoes.length === 0) {
        alert('‚ö† Nenhuma altera√ß√£o v√°lida encontrada!');
        return;
    }
    
    // Confirmar a√ß√£o
    let mensagem = `‚ö† Voc√™ est√° prestes a atualizar ${alteracoes.length} OSC(s):\n\n`;
    alteracoes.slice(0, 5).forEach(alt => {
        mensagem += `"${alt.antiga}" ‚Üí "${alt.nova}"\n`;
    });
    if (alteracoes.length > 5) {
        mensagem += `\n... e mais ${alteracoes.length - 5} altera√ß√£o(√µes)\n`;
    }
    mensagem += '\nTODOS os termos associados ser√£o atualizados!\n\nDeseja continuar?';
    
    if (!confirm(mensagem)) {
        return;
    }
    
    // Desabilitar bot√£o e mostrar progresso
    const actionBar = document.getElementById('actionBar');
    const btnSalvar = actionBar.querySelector('.btn-success');
    btnSalvar.disabled = true;
    btnSalvar.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Salvando...';
    
    // Processar altera√ß√µes sequencialmente
    processarAlteracoesSequenciais(alteracoes, 0, []);
}

function processarAlteracoesSequenciais(alteracoes, indice, resultados) {
    if (indice >= alteracoes.length) {
        // Todas conclu√≠das
        const sucesso = resultados.filter(r => r.sucesso).length;
        const erros = resultados.filter(r => !r.sucesso).length;
        
        let mensagem = `‚úÖ Processo conclu√≠do!\n\n`;
        mensagem += `Sucesso: ${sucesso}\n`;
        if (erros > 0) {
            mensagem += `Erros: ${erros}\n\n`;
            mensagem += 'Erros encontrados:\n';
            resultados.filter(r => !r.sucesso).forEach(r => {
                mensagem += `- ${r.antiga}: ${r.erro}\n`;
            });
        }
        
        alert(mensagem);
        setTimeout(() => location.reload(), 1000);
        return;
    }
    
    const alteracao = alteracoes[indice];
    
    // Atualizar contador
    document.getElementById('contadorSelecionados').textContent = 
        `Processando ${indice + 1} de ${alteracoes.length}...`;
    
    fetch('/parcerias/atualizar-osc', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            osc_antiga: alteracao.antiga,
            osc_nova: alteracao.nova
        })
    })
    .then(r => r.json())
    .then(data => {
        if (data.error) {
            resultados.push({
                antiga: alteracao.antiga,
                nova: alteracao.nova,
                sucesso: false,
                erro: data.error
            });
        } else {
            resultados.push({
                antiga: alteracao.antiga,
                nova: alteracao.nova,
                sucesso: true,
                linhas: data.linhas_afetadas
            });
        }
        
        // Processar pr√≥xima
        processarAlteracoesSequenciais(alteracoes, indice + 1, resultados);
    })
    .catch(error => {
        resultados.push({
            antiga: alteracao.antiga,
            nova: alteracao.nova,
            sucesso: false,
            erro: error.toString()
        });
        
        // Processar pr√≥xima mesmo com erro
        processarAlteracoesSequenciais(alteracoes, indice + 1, resultados);
    });
}

function salvarOSC(btn) {
    const linha = btn.closest('tr');
    const input = linha.querySelector('.osc-input');
    const oscAntiga = input.dataset.original;
    const oscNova = input.value.trim();
    
    if (!oscNova) { 
        alert('‚ö† Nome da OSC n√£o pode estar vazio!'); 
        return; 
    }
    
    if (oscAntiga === oscNova) { 
        alert('‚Ñπ Nenhuma altera√ß√£o detectada.'); 
        return; 
    }
    
    if (!confirm('‚ö† Atualizar TODOS os termos de:\n"' + oscAntiga + '"\n\nPara:\n"' + oscNova + '"?')) 
        return;
    
    btn.disabled = true;
    const htmlOriginal = btn.innerHTML;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
    
    fetch('/parcerias/atualizar-osc', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            osc_antiga: oscAntiga, 
            osc_nova: oscNova
        })
    })
    .then(r => r.json())
    .then(data => {
        if (data.error) {
            alert('‚ùå Erro: ' + data.error);
            btn.disabled = false;
            btn.innerHTML = htmlOriginal;
        } else {
            alert('‚úÖ ' + data.message);
            input.dataset.original = oscNova;
            input.classList.remove('modified');
            setTimeout(() => location.reload(), 1000);
        }
    })
    .catch(error => {
        alert('‚ùå Erro: ' + error);
        btn.disabled = false;
        btn.innerHTML = htmlOriginal;
    });
}

// Event listener para badges de termos
document.addEventListener('DOMContentLoaded', function() {
    configurarEventosBadges();
});

function configurarEventosBadges() {
    document.querySelectorAll('.badge-termos').forEach(badge => {
        badge.removeEventListener('click', handleBadgeClick);
        badge.addEventListener('click', handleBadgeClick);
    });
}

function handleBadgeClick() {
    const osc = this.getAttribute('data-osc');
    const totalTermos = this.getAttribute('data-total-termos');
    verTermos(osc, totalTermos);
}

// ============================================================================
// GERENCIAMENTO DE CONTATOS
// ============================================================================

let oscAtualContatos = '';
let contatoIdCounter = 0;

function gerenciarContatos(osc) {
    oscAtualContatos = osc;
    document.getElementById('oscNomeContatos').textContent = osc;
    
    // Mostrar modal
    const modal = new bootstrap.Modal(document.getElementById('modalContatos'));
    modal.show();
    
    // Limpar formul√°rio e blocos
    document.getElementById('formNovoContato').reset();
    document.getElementById('contatosContainer').innerHTML = '';
    contatoIdCounter = 0;
    
    // Adicionar primeiro bloco
    adicionarBlocoContato();
    
    // Inicializar tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Carregar contatos
    carregarContatos(osc);
}

function adicionarBlocoContato() {
    contatoIdCounter++;
    const id = contatoIdCounter;
    
    const html = `
        <div class="card mb-2" id="blocoContato_${id}">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <strong>Contato #${id}</strong>
                    <button type="button" class="btn btn-sm btn-danger" onclick="removerBlocoContato(${id})" title="Remover">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
                <div class="row g-2">
                    <div class="col-md-4">
                        <label class="form-label">Tipo *</label>
                        <select class="form-select form-select-sm" id="tipo_${id}" required onchange="ajustarMascaraBloco(${id})">
                            <option value="">-- Selecione --</option>
                            <option value="E-mail Institucional">E-mail Institucional</option>
                            <option value="E-mail Pessoal">E-mail Pessoal</option>
                            <option value="Telefone Institucional">Telefone Institucional</option>
                            <option value="Telefone Pessoal">Telefone Pessoal</option>
                        </select>
                    </div>
                    <div class="col-md-5">
                        <label class="form-label">Informa√ß√£o *</label>
                        <input type="text" class="form-control form-control-sm" id="info_${id}" required>
                        <small class="text-muted" id="hint_${id}">Selecione o tipo</small>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Status *</label>
                        <select class="form-select form-select-sm" id="status_${id}" required>
                            <option value="Ativo" selected>Ativo</option>
                            <option value="Inativo">Inativo</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('contatosContainer').insertAdjacentHTML('beforeend', html);
}

function removerBlocoContato(id) {
    const bloco = document.getElementById('blocoContato_' + id);
    if (bloco) {
        bloco.remove();
    }
    
    // Renumerar blocos restantes
    const blocos = document.querySelectorAll('[id^="blocoContato_"]');
    blocos.forEach((bloco, index) => {
        const strong = bloco.querySelector('strong');
        if (strong) {
            strong.textContent = 'Contato #' + (index + 1);
        }
    });
}

function ajustarMascaraBloco(id) {
    const tipoSelect = document.getElementById('tipo_' + id);
    const infoInput = document.getElementById('info_' + id);
    const hint = document.getElementById('hint_' + id);
    
    const tipo = tipoSelect.value;
    
    // Remover m√°scara anterior
    infoInput.value = '';
    infoInput.removeAttribute('inputmode');
    infoInput.removeAttribute('maxlength');
    infoInput.type = 'text';
    
    if (tipo.includes('E-mail')) {
        infoInput.type = 'email';
        infoInput.placeholder = 'exemplo@dominio.com';
        hint.textContent = 'Digite um e-mail v√°lido';
    } else if (tipo.includes('Telefone')) {
        infoInput.inputMode = 'tel';
        infoInput.placeholder = '(11) 98888-8888';
        infoInput.maxLength = 15;
        hint.textContent = 'Formato: (XX) XXXXX-XXXX';
        
        // Aplicar m√°scara de telefone
        infoInput.addEventListener('input', function(e) {
            let valor = e.target.value.replace(/\D/g, '');
            if (valor.length > 11) valor = valor.substring(0, 11);
            
            if (valor.length >= 11) {
                valor = valor.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
            } else if (valor.length >= 7) {
                valor = valor.replace(/^(\d{2})(\d{4,5})(\d{0,4}).*/, '($1) $2-$3');
            } else if (valor.length >= 3) {
                valor = valor.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
            } else if (valor.length >= 1) {
                valor = valor.replace(/^(\d*)/, '($1');
            }
            
            e.target.value = valor;
        });
    } else {
        hint.textContent = 'Selecione o tipo';
        infoInput.placeholder = '';
    }
}

function carregarContatos(osc) {
    const listaContatos = document.getElementById('listaContatos');
    listaContatos.innerHTML = '<div class="text-center"><div class="spinner-border text-info" role="status"><span class="visually-hidden">Carregando...</span></div></div>';
    
    fetch('/parcerias/contatos/' + encodeURIComponent(osc))
        .then(r => r.json())
        .then(data => {
            if (data.error) {
                listaContatos.innerHTML = '<div class="alert alert-danger">‚ùå Erro: ' + data.error + '</div>';
                return;
            }
            
            if (data.contatos.length === 0) {
                listaContatos.innerHTML = '<div class="alert alert-warning"><i class="bi bi-info-circle"></i> Nenhum contato cadastrado ainda. Use o formul√°rio acima para adicionar.</div>';
                return;
            }
            
            // Criar tabela com os contatos
            let html = '<div class="table-responsive"><table class="table table-hover table-striped">';
            html += '<thead class="table-info"><tr>';
            html += '<th>Nome</th>';
            html += '<th>Posi√ß√£o</th>';
            html += '<th>Tipo</th>';
            html += '<th>Contato</th>';
            html += '<th>Status</th>';
            html += '<th>A√ß√µes</th>';
            html += '</tr></thead><tbody>';
            
            data.contatos.forEach(contato => {
                const statusBadge = contato.status === 'Ativo' ? 'bg-success' : 'bg-secondary';
                const contatoIcon = contato.contato_tipo.includes('E-mail') ? 'bi-envelope' : 'bi-telephone';
                
                html += '<tr>';
                html += '<td><strong>' + contato.contato_nome + '</strong></td>';
                html += '<td>' + (contato.contato_posicao || '-') + '</td>';
                html += '<td><span class="badge bg-primary">' + contato.contato_tipo + '</span></td>';
                html += '<td><i class="bi ' + contatoIcon + '"></i> ' + contato.contato_info + '</td>';
                html += '<td><span class="badge ' + statusBadge + '">' + contato.status + '</span></td>';
                html += '<td>';
                html += '<button class="btn btn-sm btn-warning me-1" onclick="editarContato(' + contato.id + ')" title="Editar"><i class="bi bi-pencil"></i></button>';
                html += '<button class="btn btn-sm btn-danger" onclick="excluirContato(' + contato.id + ', \'' + contato.contato_nome + '\')" title="Excluir"><i class="bi bi-trash"></i></button>';
                html += '</td>';
                html += '</tr>';
            });
            
            html += '</tbody></table></div>';
            listaContatos.innerHTML = html;
        })
        .catch(error => {
            listaContatos.innerHTML = '<div class="alert alert-danger">‚ùå Erro ao carregar contatos: ' + error + '</div>';
        });
}

function ajustarMascara(prefixo) {
    const tipoSelect = document.getElementById(prefixo + '_contato_tipo');
    const infoInput = document.getElementById(prefixo + '_contato_info');
    const hint = document.getElementById('hint_' + prefixo);
    
    const tipo = tipoSelect.value;
    
    // Remover m√°scara anterior
    infoInput.value = '';
    infoInput.removeAttribute('inputmode');
    infoInput.removeAttribute('maxlength');
    infoInput.type = 'text';
    
    if (tipo.includes('E-mail')) {
        infoInput.type = 'email';
        infoInput.placeholder = 'exemplo@dominio.com';
        hint.textContent = 'Digite um e-mail v√°lido';
    } else if (tipo.includes('Telefone')) {
        infoInput.inputMode = 'tel';
        infoInput.placeholder = '(11) 98888-8888';
        infoInput.maxLength = 15;
        hint.textContent = 'Digite no formato (XX) XXXXX-XXXX';
        
        // Aplicar m√°scara de telefone
        infoInput.addEventListener('input', function(e) {
            let valor = e.target.value.replace(/\D/g, '');
            if (valor.length > 11) valor = valor.substring(0, 11);
            
            if (valor.length >= 11) {
                valor = valor.replace(/^(\d{2})(\d{5})(\d{4}).*/, '($1) $2-$3');
            } else if (valor.length >= 7) {
                valor = valor.replace(/^(\d{2})(\d{4,5})(\d{0,4}).*/, '($1) $2-$3');
            } else if (valor.length >= 3) {
                valor = valor.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
            } else if (valor.length >= 1) {
                valor = valor.replace(/^(\d*)/, '($1');
            }
            
            e.target.value = valor;
        });
    } else {
        hint.textContent = 'Selecione o tipo primeiro';
        infoInput.placeholder = '';
    }
}

// Formul√°rio de novo contato
document.getElementById('formNovoContato').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Coletar todos os blocos de contato
    const blocos = document.querySelectorAll('[id^="blocoContato_"]');
    const contatos = [];
    
    blocos.forEach(bloco => {
        const id = bloco.id.replace('blocoContato_', '');
        const tipo = document.getElementById('tipo_' + id)?.value;
        const info = document.getElementById('info_' + id)?.value.trim();
        const status = document.getElementById('status_' + id)?.value;
        
        if (tipo && info) {
            contatos.push({ tipo, info, status });
        }
    });
    
    if (contatos.length === 0) {
        alert('‚ö† Adicione pelo menos um tipo de contato!');
        return;
    }
    
    const dados = {
        osc: oscAtualContatos,
        contato_nome: document.getElementById('novo_contato_nome').value.trim(),
        contato_posicao: document.getElementById('novo_contato_posicao').value.trim(),
        observacao: document.getElementById('novo_observacao').value.trim(),
        contatos: contatos
    };
    
    fetch('/parcerias/contatos/criar', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(dados)
    })
    .then(r => r.json())
    .then(data => {
        if (data.error) {
            alert('‚ùå Erro: ' + data.error);
        } else {
            alert('‚úÖ ' + data.message);
            document.getElementById('formNovoContato').reset();
            document.getElementById('contatosContainer').innerHTML = '';
            contatoIdCounter = 0;
            adicionarBlocoContato();
            carregarContatos(oscAtualContatos);
        }
    })
    .catch(error => {
        alert('‚ùå Erro ao criar contato: ' + error);
    });
});

function editarContato(id) {
    // Buscar dados do contato
    fetch('/parcerias/contatos/' + encodeURIComponent(oscAtualContatos))
        .then(r => r.json())
        .then(data => {
            const contato = data.contatos.find(c => c.id === id);
            if (!contato) {
                alert('‚ùå Contato n√£o encontrado!');
                return;
            }
            
            // Preencher formul√°rio
            document.getElementById('edit_contato_id').value = contato.id;
            document.getElementById('edit_contato_nome').value = contato.contato_nome;
            document.getElementById('edit_contato_posicao').value = contato.contato_posicao || '';
            document.getElementById('edit_contato_tipo').value = contato.contato_tipo;
            document.getElementById('edit_contato_info').value = contato.contato_info;
            document.getElementById('edit_status').value = contato.status;
            document.getElementById('edit_observacao').value = contato.observacao || '';
            
            // Ajustar m√°scara
            ajustarMascara('edit');
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('modalEditarContato'));
            modal.show();
        })
        .catch(error => {
            alert('‚ùå Erro ao buscar contato: ' + error);
        });
}

// Formul√°rio de editar contato
document.getElementById('formEditarContato').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const id = document.getElementById('edit_contato_id').value;
    const dados = {
        contato_nome: document.getElementById('edit_contato_nome').value.trim(),
        contato_posicao: document.getElementById('edit_contato_posicao').value.trim(),
        contato_tipo: document.getElementById('edit_contato_tipo').value,
        contato_info: document.getElementById('edit_contato_info').value.trim(),
        status: document.getElementById('edit_status').value,
        observacao: document.getElementById('edit_observacao').value.trim()
    };
    
    fetch('/parcerias/contatos/editar/' + id, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(dados)
    })
    .then(r => r.json())
    .then(data => {
        if (data.error) {
            alert('‚ùå Erro: ' + data.error);
        } else {
            alert('‚úÖ ' + data.message);
            bootstrap.Modal.getInstance(document.getElementById('modalEditarContato')).hide();
            carregarContatos(oscAtualContatos);
        }
    })
    .catch(error => {
        alert('‚ùå Erro ao editar contato: ' + error);
    });
});

function excluirContato(id, nome) {
    if (!confirm('‚ö† Tem certeza que deseja excluir o contato de:\n"' + nome + '"?')) {
        return;
    }
    
    fetch('/parcerias/contatos/deletar/' + id, {
        method: 'POST'
    })
    .then(r => r.json())
    .then(data => {
        if (data.error) {
            alert('‚ùå Erro: ' + data.error);
        } else {
            alert('‚úÖ ' + data.message);
            carregarContatos(oscAtualContatos);
        }
    })
    .catch(error => {
        alert('‚ùå Erro ao excluir contato: ' + error);
    });
}
</script>
</body>
</html>
